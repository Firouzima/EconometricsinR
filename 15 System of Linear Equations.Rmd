---
title: "15 System of Linear Equations"
author: "Mohammadamin Firouzi"
date: "2025-07-26"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# System of Linear Equations

```{r message=FALSE, warning=FALSE}

# install.packages('systemfit')
# install.packages('plm')
library(systemfit)
library(plm)
```

#### Seemingly Unrelated Regressions (SUR):

```{r}

data("GrunfeldGreene")

df = pdata.frame(GrunfeldGreene, index = c('firm', 'year'))

sur = systemfit(invest ~ value + capital, method = 'SUR', data = df)
summary(sur, residCov = FALSE, equations = FALSE)
```

#### Simultaneous Equations Models (SEM):

$hours = \beta_{12}\log(wage) + \beta_{10} + \beta_{11}educ + \beta_{12}age + \beta_{13}kidslt6 + \beta_{14}nwifeinc + \beta_{15}exper + \beta_{16}exper^2 + u_1$

$\log(wage) = \beta_{21}hours + \beta_{20} + \beta_{21}educ + \beta_{22}age + \beta_{23}kidslt6 + \beta_{24}nwifeinc + \beta_{25}exper + \beta_{26}exper^2 + u_2$

#### Estimation by 2SLS (ivreg):

```{r message=FALSE, warning=FALSE}

library(AER)
library(wooldridge)
library(stargazer)

data(mroz)
smpl = subset(mroz, !is.na(wage))
```

For both equations to be identified, we have to exclude at least one exogenous regressor from each equation. Wooldridge (2019) discusses a model in which we restrict $\beta_{15} = \beta_{16} = 0$ in the first and $\beta_{22} = \beta_{23} = \beta_{24} = 0$ in the second equation.

```{r message=FALSE, warning=FALSE}

eq1 = ivreg(hours ~ log(wage) + educ + age + kidslt6 + nwifeinc |
              educ + age + kidslt6 + nwifeinc + exper + I(exper ^ 2),
            data = smpl)
eq2 = ivreg(log(wage) ~ hours + educ + exper + I(exper ^ 2) |
              educ + age + kidslt6 + nwifeinc + exper + I(exper ^ 2),
            data = smpl)

se_rob = list(sqrt(diag(vcovHC(eq1, type = 'HC1'))),
              sqrt(diag(vcovHC(eq2, type = 'HC1'))))

stargazer(eq1, eq2, se = se_rob, type = 'text')
```

#### Estimation by 2SLS (systemfit):

```{r}

eq_hours = hours ~ log(wage) + educ + age + kidslt6 + nwifeinc
eq_lwage = log(wage) ~ hours + educ + exper + I(exper ^ 2)
eq_system = list(eq_hours, eq_lwage)
instruments = ~ educ + age + kidslt6 + nwifeinc + exper + I(exper ^ 2)

sem = systemfit(eq_system, inst = instruments, data = smpl, method = '2SLS')
summary(sem, equations = FALSE)

# summary(eq1)
# summary(eq2)
```

#### Estimation by 3SLS (systemfit):

```{r message=FALSE, warning=FALSE}

sem_3sls = systemfit(eq_system, inst = instruments, data = smpl, method = '3SLS')
summary(sem_3sls, equations = FALSE)
```
